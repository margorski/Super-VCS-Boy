; section SetHorizPos
SetHorizPos
	; inlined wsync
    STA     WSYNC
	; end of inlined wsync
;  	wsync 
;  	*3 c+ {	a-15 } >=
    NOP     $80
    SEc
__label_3
    SBC     #$0F
    BCS     __label_3
;  	a^0x07 a<< a<< a<< a<<
    EOR     #$07
    ASL
    ASL
    ASL
    ASL
;  	rp0,x=a hp0,x=a
    STA     rp0,X
    STA     hp0,X
;  }
;  
    RTS
; section Frame0
Frame0
    .byte     #$00
;  	0x00
;  	0b01100110
;  	0b11111111
    .byte     #$66
;  	0b11110011
    .byte     #$FF
;  	0b11100001
    .byte     #$F3
;  	0b11111111
    .byte     #$E1
;  	0b10001100
    .byte     #$FF
;  	0b11001101
    .byte     #$8C
;  	0b11111111
    .byte     #$CD
;  }
    .byte     #$FF
;  
; section ColorFrame0
ColorFrame0
    .byte     #$C4
;  	0xC4
;  	0xC4
;  	0xC2
    .byte     #$C4
;  	0xC2
    .byte     #$C2
;  	0xC2
    .byte     #$C2
;  	0xC2
    .byte     #$C2
;  	0xC2
    .byte     #$C2
;  	0xC2
    .byte     #$C2
;  	0xC2
    .byte     #$C2
;  }
    .byte     #$C2
;  
; section MoveJoystick
MoveJoystick
    LDX     xspeed
;  	// down
;  	//a=0b00100000 a&?swcha == { x-- }	
;  	// up
;  	//a=0b00010000 a&?swcha == { x?254 <{ x++ }}	
;  	// leftv
;  
;  	x=xspeed 
;  	//left 
;  	a=0b01000000 a&?swcha == { 
    LDA     #$40
    BIT     swcha
    BNE     __label_4
;  		a=x c+ o- a-XACC <<= {a=0x81}
    TXA
    SEc
    CLv
    SBC     #$08
    BVC     __label_5
    LDA     #$81
;  	}	
__label_5
    JMP     __label_6
__label_4
;  	else { 
    LDA     #$80
;  		a=0b10000000 a&?swcha == { 
    BIT     swcha
    BNE     __label_7
;  			a=x c- o- a+XACC <<= { a=0x7F }
    TXA
    CLc
    CLv
    ADC     #$08
    BVC     __label_8
    LDA     #$7F
;  		}
__label_8
;  		else {
    JMP     __label_9
__label_7
;  			a=x == { return }
    TXA
    BNE     __label_10
    RTS
;  			<0 {
__label_10
    BPL     __label_11
;  				c- o- a+TORQUE <<= {a=0}
    CLc
    CLv
    ADC     #$07
    BVC     __label_12
    LDA     #$00
;  			}
__label_12
;  			else {
    JMP     __label_13
__label_11
;  				c+ o- a-TORQUE <<= {a=0}
    SEc
    CLv
    SBC     #$07
    BVC     __label_14
    LDA     #$00
;  			}
__label_14
;  		}
__label_13
;  	} 
__label_9
__label_6
;  	xspeed=a
    STA     xspeed
;  }
;  
    RTS
; section UpdateHorizontal
UpdateHorizontal
    LDA     xspeed
;  	a=xspeed
;  	== { 
    BNE     __label_15
;  		return
;  	}
    RTS
;  	a&0x80 <0 {
__label_15
    AND     #$80
    BPL     __label_16
;  		a=xspeed ComputeU2 a>> a>> a>> a>> a>> Temp2=a a=XPos0 
    LDA     xspeed
	; inlined ComputeU2
    EOR     #$FF
    CLc
    ADC     #$01
	; end of inlined ComputeU2
    LSR
    LSR
    LSR
    LSR
    LSR
    STA     Temp2
    LDA     XPos0
;  		c+ a-Temp2 <{a=0}
    SEc
    SBC     Temp2
    BCS     __label_17
    LDA     #$00
;  	}
__label_17
;  	else {
    JMP     __label_18
__label_16
;  		a=xspeed a>> a>> a>> a>> a>>
    LDA     xspeed
    LSR
    LSR
    LSR
    LSR
    LSR
;  		c- a+XPos0 a?MAX_X >={ a=MAX_X }
    CLc
    ADC     XPos0
    CMP     #$78
    BCC     __label_19
    LDA     #$78
;  	}
__label_19
;  	XPos0=a
__label_18
    STA     XPos0
;  }
;  
    RTS
; section pf0_0
pf0_0
;  	align 256
;  	image test2 3 23 4< 24^	
    .byte   #$00
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$E0
    .byte   #$00
;  }
;  data pf1_0 {
; section pf1_0
pf1_0
;  	align 256
;  	image test2 4 23 8> 24^	
    .byte   #$00
    .byte   #$FF
    .byte   #$FF
    .byte   #$80
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$00
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$00
;  }
;  data pf2_0 {
; section pf2_0
pf2_0
;  	align 256
;  	image test2 19 23 8< 24^	
    .byte   #$00
    .byte   #$FF
    .byte   #$FF
    .byte   #$E0
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$7F
    .byte   #$03
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$FF
    .byte   #$FF
    .byte   #$00
;  }
;  
; section pf0_1
pf0_1
;  	align 256
;  	image test2 23 23 4< 24^	
    .byte   #$00
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$F0
    .byte   #$00
;  }
;  data pf1_1 {
; section pf1_1
pf1_1
;  	align 256
;  	image test2 24 23 8> 24^	
    .byte   #$00
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FE
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$0F
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$EF
    .byte   #$FF
    .byte   #$FF
    .byte   #$FF
    .byte   #$00
;  }
;  data pf2_1 {
; section pf2_1
pf2_1
;  	align 256
;  	image test2 39 23 8< 24^	
    .byte   #$00
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$00
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$7F
    .byte   #$00
;  }
; section DrawSprites
DrawSprites
    LDA     #$08
;  	a=SPRITE_HEIGHT c+ a - ++YP0 < { a=0 }
    SEc
    ISC     YP0
    BCS     __label_20
    LDA     #$00
;  	y=a
__label_20
    TAY
;  	Colp0=a=(ColorPtr0),y
    LDA     (ColorPtr0),Y
    STA     Colp0
;  	gp0=a=(SpritePtr0),y 
    LDA     (SpritePtr0),Y
    STA     gp0
;  	a=SPRITE_HEIGHT c+ a - ++YP1 < { a=0 }	
    LDA     #$08
    SEc
    ISC     YP1
    BCS     __label_21
    LDA     #$00
__label_21
;  	y=a
    TAY
;  	a=(ColorPtr1),y	x=a
    LDA     (ColorPtr1),Y
    TAX
;  	a=(SpritePtr1),y y=a
    LDA     (SpritePtr1),Y
    TAY
;  	a=Colp0
    LDA     Colp0
;  	wsync
;  	gp1=y cp1=x cp0=a
	; inlined wsync
    STA     WSYNC
	; end of inlined wsync
    STY     gp1
    STX     cp1
    STA     cp0
;  }
;  
    RTS
; section main
main
	; inlined init
    SEi
    CLd
    LDX     #$FF
    TXS
    LDA     #$00
__I13__label_1
    STA     zeropage,X
    DEX
	BNE	__I13__label_1
	; end of inlined init
;  	init
;  	Data0:
Data0
;  		PFPtr=a=&<Data0 			PFPtr+1=a=&>Data0
    LDA     #<(Data0)
    STA     PFPtr
    LDA     #>(Data0)
    STA     PFPtr+1
;  		SpritePtr0=a=&<Frame0 		SpritePtr0+1=a=&>Frame0
    LDA     #<(Frame0)
    STA     SpritePtr0
    LDA     #>(Frame0)
    STA     SpritePtr0+1
;  		ColorPtr0=a=&<ColorFrame0	ColorPtr0+1=a=&>ColorFrame0
    LDA     #<(ColorFrame0)
    STA     ColorPtr0
    LDA     #>(ColorFrame0)
    STA     ColorPtr0+1
;  		SpritePtr1=a=&<Frame0		SpritePtr1+1=a=&>Frame0
    LDA     #<(Frame0)
    STA     SpritePtr1
    LDA     #>(Frame0)
    STA     SpritePtr1+1
;  		ColorPtr1=a=&<ColorFrame0	ColorPtr1+1=a=&>ColorFrame0
    LDA     #<(ColorFrame0)
    STA     ColorPtr1
    LDA     #>(ColorFrame0)
    STA     ColorPtr1+1
;  		YPos0=a=242	YPos1=a=200	XPos0=XPos1=a=38
    LDA     #$F2
    STA     YPos0
    LDA     #$C8
    STA     YPos1
    LDA     #$26
    STA     XPos1
    STA     XPos0
;  		vdp0=a=1
    LDA     #$01
    STA     vdp0
;  	{
;  		sync1
__label_22
;  			cbg=a=0x88	cpf=a=0x5b cp0=a=0x68
	; inlined sync1
__I14__I1__label_2
    LDA     INTIM
	BNE	__I14__I1__label_2
    STA     WSYNC
    LDA     #$02
    STA     VBLANK
    LDA     #$21
    STA     TIM64T
	; end of inlined sync1
    LDA     #$88
    STA     cbg
    LDA     #$5B
    STA     cpf
    LDA     #$68
    STA     cp0
;  			PFIndex=a=23 YP0=a=YPos0 YP1=a=YPos1 
    LDA     #$17
    STA     PFIndex
    LDA     YPos0
    STA     YP0
    LDA     YPos1
    STA     YP1
;  			a=XPos0 x=0 SetHorizPos
    LDA     XPos0
    LDX     #$00
;  			a=XPos1 x=1 SetHorizPos			
    JSR     SetHorizPos
    LDA     XPos1
    LDX     #$01
    JSR     SetHorizPos
;  			wsync hmove=a
	; inlined wsync
    STA     WSYNC
	; end of inlined wsync
    STA     hmove
;  		sync2
;  			MoveJoystick
	; inlined sync2
__I16__I3__label_2
    LDA     INTIM
	BNE	__I16__I3__label_2
    STA     WSYNC
    LDA     #$02
    STA     VSYNC
    STA     WSYNC
    STA     WSYNC
    LDA     #$00
    STA     WSYNC
    STA     VSYNC
    LDA     #$2C
    STA     TIM64T
	; end of inlined sync2
;  			UpdateHorizontal
    JSR     MoveJoystick
;  		sync3
    JSR     UpdateHorizontal
;  			{
	; inlined sync3
__I17__I8__label_2
    LDA     INTIM
	BNE	__I17__I8__label_2
    STA     WSYNC
    LDA     #$00
    STA     VBLANK
    LDA     #$E7
    STA     TIM64T
	; end of inlined sync3
;  				// Phase 0: Fetch PF0 byte
__label_23
;  				DrawSprites
;  				y=PFIndex == { goto .NextFrame }
    JSR     DrawSprites
    LDY     PFIndex
    BNE     __label_24
    JMP     __local21_NextFrame
;  				y-- PFIndex=y
__label_24
    DEY
    STY     PFIndex
;  				tmpPF0=a=pf0_0,y
    LDA     pf0_0,Y
    STA     tmpPF0
;  				tmpPF1=a=pf1_0,y
    LDA     pf1_0,Y
    STA     tmpPF1
;  				tmpPF2=a=pf2_0,y
    LDA     pf2_0,Y
    STA     tmpPF2
;  				tmpPF3=a=pf0_1,y
    LDA     pf0_1,Y
    STA     tmpPF3
;  				tmpPF4=a=pf1_1,y
    LDA     pf1_1,Y
    STA     tmpPF4
;  				tmpPF5=a=pf2_1,y
    LDA     pf2_1,Y
    STA     tmpPF5
;  
;  				// Phase 1: Fetch PF1 byte
;  				DrawSprites
;  				DrawPlayfield
    JSR     DrawSprites
;  
	; inlined DrawPlayfield
    LDA     tmpPF0
    STA     PF0
    LDA     tmpPF1
    STA     PF1
    LDA     tmpPF2
    STA     PF2
    LDA     tmpPF3
    STA     PF0
    LDA     tmpPF4
    STA     PF1
    LDA     tmpPF5
    STA     PF2
	; end of inlined DrawPlayfield
;  				// Phase 2: Fetch PF2 byte
;  				DrawSprites
;  				DrawPlayfield
    JSR     DrawSprites
;  
	; inlined DrawPlayfield
    LDA     tmpPF0
    STA     PF0
    LDA     tmpPF1
    STA     PF1
    LDA     tmpPF2
    STA     PF2
    LDA     tmpPF3
    STA     PF0
    LDA     tmpPF4
    STA     PF1
    LDA     tmpPF5
    STA     PF2
	; end of inlined DrawPlayfield
;  				// Phase 3: Write PF0/PF1/PF2 registers
;  				DrawSprites
;  				DrawPlayfield
    JSR     DrawSprites
;  			} always
	; inlined DrawPlayfield
    LDA     tmpPF0
    STA     PF0
    LDA     tmpPF1
    STA     PF1
    LDA     tmpPF2
    STA     PF2
    LDA     tmpPF3
    STA     PF0
    LDA     tmpPF4
    STA     PF1
    LDA     tmpPF5
    STA     PF2
	; end of inlined DrawPlayfield
    JMP     __label_23
;  		.NextFrame:
__local21_NextFrame
;  	} always
    JMP     __label_22
;  }
; section __vectors
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
; section __entry
__entry
    BIT     __banksel_core
    JMP     main
